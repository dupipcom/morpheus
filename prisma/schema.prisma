generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Chart {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  name          String?
  type          String?
  data          Json?
  config        Json?
  visibility    Visibility @default(PRIVATE)
  userId        String    @db.ObjectId
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  profileId     String?   @db.ObjectId
  profile       Profile?  @relation(fields: [profileId], references: [id], onDelete: Cascade)
}

model Comment {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  content       String
  userId        String    @db.ObjectId
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  visibility    Visibility @default(PRIVATE)
  noteId        String?   @db.ObjectId
  note          Note?     @relation(fields: [noteId], references: [id], onDelete: Cascade)
  templateId    String?   @db.ObjectId
  template      Template? @relation(fields: [templateId], references: [id], onDelete: Cascade)
  listId        String?   @db.ObjectId
  list          List? @relation(fields: [listId], references: [id], onDelete: Cascade)
  profileId     String?   @db.ObjectId
  profile       Profile?  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  eventId       String?   @db.ObjectId
  event         Event?    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  likes         Like[]
  noteIds       String[]  @default([]) @db.ObjectId
}

model Day {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  date          String?
  week          Int?
  month         Int?
  quarter       Int?
  semester      Int?
  tasks         EmbeddedTask[]
  mood          Mood?
  ticker        Ticker[]
  analysis      Json?
  average       Float?
  progress      Float?
  productivity  Json?
  balance       Float?
  stash         Float?
  equity        Float?
  withdrawn     Float?
  visibility    Visibility @default(PRIVATE)
  fieldVisibility DayVisibility?
  personIds     String[]  @default([]) @db.ObjectId
  thingIds      String[]  @default([]) @db.ObjectId
  eventIds     String[]  @default([]) @db.ObjectId
  userId       String    @db.ObjectId
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  profileId    String?   @db.ObjectId
  profile      Profile? @relation(fields: [profileId], references: [id], onDelete: Cascade)
  chartIds     String[]  @default([]) @db.ObjectId
  noteIds      String[]  @default([]) @db.ObjectId
  commentIds   String[]  @default([]) @db.ObjectId
  likeIds      String[]  @default([]) @db.ObjectId

  @@unique([userId, date])
}

model Document {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  fileUrl       String
  fileName      String
  fileSize      Float?
  fileFormat    String?
  fileDuration  Float?
  visibility    Visibility @default(PRIVATE)
  users         UserReference[]
  listIds       String[]  @default([]) @db.ObjectId
  templateIds   String[]  @default([]) @db.ObjectId
  noteIds       String[]  @default([]) @db.ObjectId
  thingIds      String[]  @default([]) @db.ObjectId
  eventIds      String[]  @default([]) @db.ObjectId
  personIds     String[]  @default([]) @db.ObjectId
  profileIds    String[]  @default([]) @db.ObjectId
  chartIds      String[]  @default([]) @db.ObjectId
}

model Event {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  name          String
  userId        String    @db.ObjectId
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  quality       Int?
  visibility    Visibility @default(PRIVATE)
  noteIds       String[]  @default([]) @db.ObjectId
  documentIds   String[]  @default([]) @db.ObjectId
  comments      Comment[]
}

model Like {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  entityType    String
  entityId      String    @db.ObjectId
  noteId        String?   @db.ObjectId
  note          Note?     @relation(fields: [noteId], references: [id], onDelete: Cascade)
  templateId    String?   @db.ObjectId
  template      Template? @relation(fields: [templateId], references: [id], onDelete: Cascade)
  commentId     String?   @db.ObjectId
  comment       Comment?  @relation(fields: [commentId], references: [id], onDelete: Cascade)
  userId        String    @db.ObjectId
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  visibility    Visibility @default(PRIVATE)
  
  @@unique([userId, entityType, entityId])
}

model Note {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  content       String
  visibility    NoteVisibility @default(PRIVATE)
  userId        String    @db.ObjectId
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  date          String?
  comments      Comment[]
  likes         Like[]
  personIds      String[]  @default([]) @db.ObjectId
  thingIds       String[]  @default([]) @db.ObjectId
  eventIds       String[]  @default([]) @db.ObjectId
  profileIds     String[]  @default([]) @db.ObjectId
  templateIds    String[]  @default([]) @db.ObjectId
  listIds        String[]  @default([]) @db.ObjectId
  documentIds    String[]  @default([]) @db.ObjectId
  chartIds       String[]  @default([]) @db.ObjectId
  reviewerJobIds String[]  @default([]) @db.ObjectId
  reviewerJobs   Job[]     @relation("JobReviewersNotes", fields: [reviewerJobIds], references: [id])
}

model Offer {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  name          String?
  description   String?
  price         Float?
  discount      Float?
  visibility    Visibility @default(PRIVATE)
  userId        String    @db.ObjectId
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  productId    String?   @db.ObjectId
  product       Product? @relation(fields: [productId], references: [id], onDelete: Cascade)
  noteIds       String[]  @default([]) @db.ObjectId
  documentIds   String[]  @default([]) @db.ObjectId
}

model Person {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  name          String
  userId        String    @db.ObjectId
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  quality Int?
  visibility    Visibility @default(PRIVATE)
  profileIds    String[]  @default([]) @db.ObjectId
  profiles      Profile[] @relation("PersonProfiles", fields: [profileIds], references: [id])
  noteIds       String[]  @default([]) @db.ObjectId
  documentIds   String[]  @default([]) @db.ObjectId
}

model Product {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  name          String
  description   String?
  price         Float?
  goal          Float?
  raised        Float?
  visibility    Visibility @default(PRIVATE)
  users         UserReference[]
  offers        Offer[]
  transactions  Transaction[]
  listIds       String[]  @default([]) @db.ObjectId
  noteIds       String[]  @default([]) @db.ObjectId
  documentIds   String[]  @default([]) @db.ObjectId
}

model Profile {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  userId        String    @unique @db.ObjectId
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  username      String?   @unique
  visibility    Visibility @default(PUBLIC)
  data          ProfileData?
  personIds     String[]  @default([]) @db.ObjectId
  persons       Person[]  @relation("PersonProfiles", fields: [personIds], references: [id])
  noteIds       String[]  @default([]) @db.ObjectId
  documentIds   String[]  @default([]) @db.ObjectId
  comments      Comment[]
  charts        Chart[]
  days          Day[]
}

model List {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  visibility    Visibility @default(PRIVATE)
  role          String?
  name          String?
  categories    Category[]
  area          Areas?
  budget        Float?
  budgetPercentage Float? @default(0)
  remainingBudget String?
  dueDate       String?
  users         UserReference[]
  publicUrl     String?
  ticker        String?
  progress      String?
  completion    Float?
  templateId    String?   @db.ObjectId
  template      Template? @relation(fields: [templateId], references: [id])
  templateTasks EmbeddedTask[]
  taskIds       String[]  @default([]) @db.ObjectId
  tasks         Task[]
  jobs          Job[]
  walletId      String?   @db.ObjectId
  wallet        Wallet?   @relation(fields: [walletId], references: [id])
  history       ListHistoryEntry[]
  raisedTransactionIds String[] @default([]) @db.ObjectId
  raisedTransactions Transaction[] @relation("ListRaised", fields: [raisedTransactionIds], references: [id])
  noteIds       String[]  @default([]) @db.ObjectId
  documentIds   String[]  @default([]) @db.ObjectId
  comments      Comment[]
}

model Template {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  visibility    Visibility @default(PRIVATE)
  role          String?
  name          String?
  users         UserReference[]
  clonedBy      String[]  @default([]) @db.ObjectId
  tasks         EmbeddedTask[]
  lists         List[]
  comments      Comment[]
  likes         Like[]
  noteIds       String[]  @default([]) @db.ObjectId
  documentIds   String[]  @default([]) @db.ObjectId
}

model Thing {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  name          String
  userId        String    @db.ObjectId
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  quality Int?
  visibility    Visibility @default(PRIVATE)
  noteIds       String[]  @default([]) @db.ObjectId
  documentIds   String[]  @default([]) @db.ObjectId
}

model Token {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  token         String
  type          String?
  expiresAt     DateTime?
  visibility    Visibility @default(PRIVATE)
  userId        String    @db.ObjectId
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  noteIds       String[]  @default([]) @db.ObjectId
  documentIds   String[]  @default([]) @db.ObjectId
}

model Transaction {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  amount        Float
  type          String?
  status        String?
  fromAddress   String
  toAddress     String
  visibility    Visibility @default(PRIVATE)
  userId        String    @db.ObjectId
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  walletId      String?   @db.ObjectId
  wallet        Wallet?   @relation(fields: [walletId], references: [id], onDelete: Cascade)
  productId    String?   @db.ObjectId
  product       Product? @relation(fields: [productId], references: [id], onDelete: Cascade)
  noteIds       String[]  @default([]) @db.ObjectId
  documentIds   String[]  @default([]) @db.ObjectId
  raisedByTaskIds String[] @default([]) @db.ObjectId
  raisedByTasks Task[]   @relation("TaskRaised", fields: [raisedByTaskIds], references: [id])
  raisedByListIds String[] @default([]) @db.ObjectId
  raisedByLists List[]   @relation("ListRaised", fields: [raisedByListIds], references: [id])
}

model User {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  settings      Settings?
  consents      Consents?
  userId        String?   @unique
  lastLogin     DateTime?
  usedBudget    Float?    @default(0)
  remainingBudget Float?  @default(100)
  stash         Float?    @default(0)
  profit        Float?    @default(0)
  equity        Float?    @default(0)
  availableBalance Float? @default(0)
  withdrawn     Float?    @default(0)
  persons       Person[]
  things        Thing[]
  events        Event[]
  notes         Note[]
  comments      Comment[]
  likes         Like[]
  profiles       Profile[]
  charts        Chart[]
  days          Day[]
  friends       String[]  @default([]) @db.ObjectId
  friendUsers   User[]    @relation("UserFriends", fields: [friends], references: [id])
  friendOfIds  String[]  @default([]) @db.ObjectId
  friendOf      User[]    @relation("UserFriends", fields: [friendOfIds], references: [id])
  closeFriends  String[]  @default([]) @db.ObjectId
  closeFriendUsers User[]  @relation("UserCloseFriends", fields: [closeFriends], references: [id])
  closeFriendOfIds String[] @default([]) @db.ObjectId
  closeFriendOf User[]    @relation("UserCloseFriends", fields: [closeFriendOfIds], references: [id])
  friendRequests String[]  @default([]) @db.ObjectId
  friendRequestUsers User[] @relation("UserFriendRequests", fields: [friendRequests], references: [id])
  friendRequestOfIds String[] @default([]) @db.ObjectId
  friendRequestOf User[]  @relation("UserFriendRequests", fields: [friendRequestOfIds], references: [id])
  offers        Offer[]
  tokens       Token[]
  transactions  Transaction[]
  wallets       Wallet[]
  workerJobs    Job[]     @relation("JobWorker")
  candidateTaskIds String[] @default([]) @db.ObjectId
  candidateTasks Task[]   @relation("TaskCandidates", fields: [candidateTaskIds], references: [id])
  reviewerJobIds String[] @default([]) @db.ObjectId
  reviewerJobs  Job[]     @relation("JobReviewers", fields: [reviewerJobIds], references: [id])
}

model Wallet {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  name          String?
  address       String?
  visibility    Visibility @default(PRIVATE)
  userId        String    @db.ObjectId
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions  Transaction[]
  noteIds       String[]  @default([]) @db.ObjectId
  documentIds   String[]  @default([]) @db.ObjectId
  lists         List[]
}

model Task {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  name          String
  categories    Category[]
  area          Areas
  status        TaskStatus @default(OPEN)
  
  // Recurrence fields
  recurrence    RecurrenceRule?
  nextOccurrence DateTime?
  lastOccurrence DateTime?
  firstOccurrence DateTime?
  
  times         Int?
  count         Int?
  localeKey     String?
  persons       PersonReference[]
  things        ThingReference[]
  events        EventReference[]
  notes         NoteReference[]
  documents     DocumentReference[]
  completedOn   String?
  dueDate       DateTime?
  budget        Float?
  visibility    Visibility?
  quality       Int?
  redacted      Boolean?  @default(false)
  
  // Relations
  listId        String?   @db.ObjectId
  list          List?     @relation(fields: [listId], references: [id], onDelete: Cascade)
  jobs          Job[]
  candidateIds  String[]  @default([]) @db.ObjectId
  candidates    User[]    @relation("TaskCandidates", fields: [candidateIds], references: [id])
  raisedTransactionIds String[] @default([]) @db.ObjectId
  raisedTransactions Transaction[] @relation("TaskRaised", fields: [raisedTransactionIds], references: [id])
}

model Job {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  selfReview    Float?
  peerReview    Float?
  managerReview Float?
  status        JobStatus @default(REQUESTED)
  workerId      String    @db.ObjectId
  worker        User      @relation("JobWorker", fields: [workerId], references: [id], onDelete: Cascade)
  taskId        String    @db.ObjectId
  task          Task      @relation(fields: [taskId], references: [id], onDelete: Cascade)
  listId        String    @db.ObjectId
  list          List      @relation(fields: [listId], references: [id], onDelete: Cascade)
  reviewerIds   String[]  @default([]) @db.ObjectId
  reviewers     User[]    @relation("JobReviewers", fields: [reviewerIds], references: [id])
  reviewersNoteIds String[] @default([]) @db.ObjectId
  reviewersNotes Note[]   @relation("JobReviewersNotes", fields: [reviewersNoteIds], references: [id])
}

type Completer {
  id String  @db.ObjectId
  earnings Float?
  prize Float?
  time Int
  completedAt DateTime
}

type Currency {
  code CurrencyCode?
  symbol String?
}

type DayVisibility {
  lists Boolean
  mood Boolean
  ticker Boolean
  analysis Boolean
}

type DocumentReference {
  id String
  fileName String
  fileUrl String
}

type EventReference {
  id String
  name String
}

type Mood {
  gratitude Float
  optimism Float
  restedness Float
  tolerance Float
  selfEsteem Float
  trust Float
}

type NoteReference {
  id String
  content String
}

type PersonReference {
  id String
  name String
}

type ProfileData {
  username ProfileField?
  firstName ProfileField?
  lastName ProfileField?
  bio ProfileField?
  profilePicture ProfileField?
  charts ProfileChartField?
}

type ProfileChartField {
  name String?
  value Json?
  visibility Boolean
}

type ProfileField {
  name String?
  value String?
  visibility Boolean
}

type Settings {
  currency Currency?
  speed Float?
}

type Consents {
  doInvestDemo DoInvestDemoConsent?
}

type DoInvestDemoConsent {
  consentedOn DateTime
  consentQuestion String
}

type EmbeddedTask {
  id String?

  name String
  categories Category[]
  area Areas
  status String

  // Recurrence fields
  recurrence RecurrenceRule?
  nextOccurrence DateTime?
  lastOccurrence DateTime?
  firstOccurrence DateTime?

  times Int?
  count Int?
  localeKey String?
  persons PersonReference[]
  things ThingReference[]
  events EventReference[]
  notes NoteReference[]
  documents DocumentReference[]
  createdAt String?
  completedOn String?
  dueDate DateTime?
  budget Float?
  visibility Visibility?
  quality Int?
  redacted Boolean? @default(false)
}

type RecurrenceRule {
  frequency RecurrenceFrequency
  interval Int @default(1)
  byWeekday Int[]
  byMonthDay Int[]
  byMonth Int[]
  endDate DateTime?
  occurrenceCount Int?
}

type ThingReference {
  id String
  name String
}

type Ticker {
  listId String?
  taskId String?
  profit Float?
  prize Float?
}

type ListProductivity {
  totalTasks Int
  completedTasks Int
  percentage Float
}

type ListHistoryEntry {
  year Int
  date String  // YYYY-MM-DD format
  operation String  // e.g., 'completed', 'requested-validation'
  username String?
  userId String @db.ObjectId
}

type UserReference {
  userId String @db.ObjectId
  role UserRole
}

enum Areas {
  self
  home
  social
  work
}

enum Category {
  body
  spirituality
  fun
  extra
  clean
  affection
  maintenance
  community
  growth
  work
  mind
  spirit
  social
  home
  custom
  event
}

enum RecurrenceFrequency {
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
  NONE
}

enum CurrencyCode {
  USD
  EUR
  JPY
  GBP
  CNY
  AUD
  CAD
  CHF
  HKD
  BRL
  SEK
  NZD
  MXN
  SGD
  NOK
  KRW
  TRY
  INR
  RUB
  ZAR
  PLN
  CZK
  HUF
  RON
  BGN
  DKK
  ISK
  RSD
  BAM
  MKD
  ALL
  MDL
  UAH
  BYN
  GEL
  AMD
  AZN
}

enum NoteVisibility {
  PRIVATE
  FRIENDS
  CLOSE_FRIENDS
  PUBLIC
  AI_ENABLED
}

enum ProfileVisibility {
  PRIVATE
  FRIENDS
  CLOSE_FRIENDS
  PUBLIC
  AI_ENABLED
}

enum UserRole {
  OWNER
  MANAGER
  COLLABORATOR
  FOLLOWER
}

enum Visibility {
  PUBLIC
  PRIVATE
  FRIENDS
  CLOSE_FRIENDS
  HIDDEN
}

enum TaskStatus {
  OPEN
  IN_PROGRESS
  STEADY
  READY
  DONE
  IGNORED
  SKIPPED
}

enum JobStatus {
  REQUESTED
  IN_PROGRESS
  VALIDATING
  ACCEPTED
  REJECTED
}
